@page "/schedules"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using BlazorBattControl.Models
@using BlazorBattControl.Data
@implements IAsyncDisposable
@inject IDbContextFactory<BlazorBattControl.Data.BlazorBattControlContext> DbFactory

<style>
    .header {
        font-weight: bold;
    }
</style>
<PageTitle>Schedules</PageTitle>

<h1>Schedules</h1>

<QuickGrid Class="table" Items="context.Schedule.OrderBy(x => x.Id)">
    <PropertyColumn Property="schedule => schedule.Name" Title="Name" />
    <PropertyColumn Property="schedule => schedule.MinSoc">
        <HeaderTemplate>
            <div class="header">Min SOC</div>
        </HeaderTemplate>
    </PropertyColumn>
    <PropertyColumn Property="schedule => schedule.MinDischargeSoc" >
        <HeaderTemplate>
            <div class="header">Min DisChg SOC</div>
        </HeaderTemplate>
    </PropertyColumn>
    <PropertyColumn Property="schedule => schedule.DischargePower">
        <HeaderTemplate>
            <div class="header">DisChg Power</div>
        </HeaderTemplate>
    </PropertyColumn>

    <TemplateColumn Context="schedule">
        <a href="@($"schedules/edit?id={schedule.Id}")">Edit</a> |
        <a href="@($"schedules/details?id={schedule.Id}")">Details</a>
    </TemplateColumn>
</QuickGrid>

@code {

    private BlazorBattControlContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
